<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pro AI Calculator with History Manager</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
</head>
<body>
  <div class="calculator">
    <h1>🧠 Pro AI Calculator</h1>
    <textarea id="input" placeholder="Type or say a calculation"></textarea>
    <div class="controls">
      <button onclick="calculate()">=</button>
      <button onclick="startVoice()">🎤</button>
      <button onclick="toggleScientific()">🧪</button>
      <button onclick="toggleDarkMode()">🌓</button>
      <button onclick="toggleHistoryPanel()">📜</button>
    </div>

    <div class="numpad">
      <!-- Buttons 0-9 and operators -->
    </div>

    <div class="scientific" id="scientific" style="display:none;">
      <!-- Scientific function buttons -->
    </div>

    <div id="result"></div>
  </div>

  <div class="history-panel" id="historyPanel">
    <div class="history-header">
      <h2>Calculation History</h2>
      <input type="text" id="searchHistory" placeholder="Search..." oninput="filterHistory()" />
      <button onclick="clearHistory()">🗑️ Clear All</button>
    </div>
    <div id="historyList"></div>
  </div>

  <script>
    function calculate() {
      const input = document.getElementById('input').value.trim();
      try {
        const result = math.evaluate(input);
        document.getElementById('result').innerText = 'Answer: ' + result;
        saveHistory(input, result);
      } catch (e) {
        document.getElementById('result').innerText = 'Error';
      }
    }

    function saveHistory(expression, result) {
      const timestamp = new Date().toLocaleString();
      const record = { expression, result, timestamp };
      const history = JSON.parse(localStorage.getItem('calcHistory') || '[]');
      history.unshift(record);
      localStorage.setItem('calcHistory', JSON.stringify(history));
      displayHistory();
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('calcHistory') || '[]');
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      history.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div><strong>${item.expression}</strong> = ${item.result}</div>
          <div class="timestamp">${item.timestamp}</div>
          <button onclick="deleteHistory(${index})">❌</button>
        `;
        historyList.appendChild(div);
      });
    }

    function deleteHistory(index) {
      const history = JSON.parse(localStorage.getItem('calcHistory') || '[]');
      history.splice(index, 1);
      localStorage.setItem('calcHistory', JSON.stringify(history));
      displayHistory();
    }

    function clearHistory() {
      if (confirm('Clear all history?')) {
        localStorage.removeItem('calcHistory');
        displayHistory();
      }
    }

    function filterHistory() {
      const query = document.getElementById('searchHistory').value.toLowerCase();
      const items = document.querySelectorAll('.history-item');
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(query) ? 'block' : 'none';
      });
    }

    function toggleHistoryPanel() {
      const panel = document.getElementById('historyPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    window.onload = displayHistory;
  </script>
</body>
</html>
